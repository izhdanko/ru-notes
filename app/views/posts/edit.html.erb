<div class="bg-light p-3">

  <h1>Редактирование заметки</h1>

  <%= form_for @post, url: post_path(@post), method: :patch do |f| %>
    
    <div class="field">
      <%= f.label :title, 'Заголовок', class: 'form-label' %>
      <%= f.text_field :title, class: 'form-control' %>
    </div>

    <div class="field">
      <%= f.label :content, 'Текст', class: 'form-label' %>
      <%= f.rich_text_area :content, class: 'form-control' %>
    </div>

    <% if current_user.admin? %>
      <div class="field">
        <%= f.label :region_id, 'Регион', class: 'form-label' %>
        <%= f.collection_select :region_id, Region.all, :id, :name, { include_blank: 'Все регионы'}, { class: 'form-select mb-3' } %>
      </div>
      <div class="field">
        <%= f.label :status, 'Статус заметки', class: 'form-label' %>
        <%= f.select :status, Post.statuses.keys.map { |s| [translate_status(s), s] }, { include_blank: false }, { class: 'form-select mb-3', style: 'width: 300px;' } %>
      </div>
    <% else %>
      <div class="field">
        <label class="form-label">Регион:</label>
        <%= @post.region.name %>
      </div>
    <% end %>

    <div class="field">
      <%= f.label :images, 'Изображения', class: 'form-label' %>
      <%= f.file_field :images, { multiple: true, class: 'form-control', type: 'file', id: 'formFileMultiple', style: 'width: 300px;' } %>
      <ul>
        <% @post.images.each do |image| %>
          <li>
            <%= image.filename %>
            <%= check_box_tag "remove_images[]", image.id, false, { class: 'form-check-input', id: "remove_images_#{image.id}" } %>
            <%= label_tag "remove_images_#{image.id}", 'Удалить изображение', class: 'form-check-label' %>
          </li>
        <% end %>
      </ul>
    </div>

    <div class="field">
      <%= f.label :files, 'Файлы', class: 'form-label' %>
      <%= f.file_field :files, { multiple: true, class: 'form-control', type: 'file', id: 'formFileMultiple', style: 'width: 300px;' } %>
      <ul>
        <% @post.files.each do |file| %>
          <li>
            <%= file.filename %>
            <%= check_box_tag "remove_files[]", file.id, false, { class: 'form-check-input', id: "remove_files_#{file.id}" } %>
            <%= label_tag "remove_files_#{file.id}", 'Удалить файл', class: 'form-check-label' %>
          </li>
        <% end %>
      </ul>
    </div>  

    <div class="actions">
      <%= f.submit 'Сохранить', class: 'btn btn-primary', style: 'width: 200px;' %>   
    </div>

    <div class="mt-3 mb-3">
      <%= link_to 'Вернуться к заметке', post_path(@post), class: 'btn btn-secondary', style: 'width: 200px; display: inline-block;' %>
    </div>
      
  <% end %>

  <% if @post.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@post.errors.count, "error") %> prohibited this post from being saved:</h2>
      <ul>
        <% @post.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

</div>
